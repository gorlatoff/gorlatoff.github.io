# üåë Project Spec: The Umbral Harmony (Polyundertonality Generatior)

### 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è (The Core)
–ì–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Just Intonation, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–µ **–æ–±—Ä–∞—Ç–Ω–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏**. –í–º–µ—Å—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è "–æ—Ç –±–∞—Å–∞ –≤–≤–µ—Ä—Ö" (–æ–±–µ—Ä—Ç–æ–Ω—ã), —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–µ—Ü–∏—Ä—É–µ—Ç –ª–∞–¥—ã "—Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑" (—É–Ω—Ç–µ—Ä—Ç–æ–Ω—ã/—Å—É–±–≥–∞—Ä–º–æ–Ω–∏–∫–∏) –æ—Ç –∑–∞–¥–∞–Ω–Ω—ã—Ö –≤–µ—Ä—à–∏–Ω, —Ñ–∏–ª—å—Ç—Ä—É—è –∏—Ö —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—É—é –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–µ—Ç–∫—É.

**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** –¢–µ–æ—Ä–∏—è "–£–º–±—Ä–∞–ª—å–Ω–æ–π –ì–∞—Ä–º–æ–Ω–∏–∏" —Å–æ–µ–¥–∏–Ω—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–µ—Ä—Ö–Ω–∏—Ö —Ç–æ—á–µ–∫ –æ–ø–æ—Ä—ã (*Apex*) —Å –µ–¥–∏–Ω—ã–º —Å–∫—Ä—ã—Ç—ã–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–º (*Depth*).

### 2. –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è (Strict Vocabulary)
*–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.*

*   **Apex (–≤–µ—Ä—à–∏–Ω–∞):** *input*. –í–µ—Ä—Ö–Ω—è—è —Ç–æ—á–∫–∞ –æ–ø–æ—Ä—ã –ª–∞–¥–∞ (—á–∏—Å–ª–∏—Ç–µ–ª—å –¥—Ä–æ–±–∏, `1/1`, `2/1`... `N/1`).
*   **Depth (–≥–ª—É–±–∏–Ω–∞):** *metric*. –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `GCD` –≤—Å–µ—Ö –Ω–æ—Ç —Å–∏—Å—Ç–µ–º—ã. –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å —ç—Ç–æ–≥–æ GCD ‚Äî –∏ –µ—Å—Ç—å "–≥–ª—É–±–∏–Ω–∞" (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ `LCM` –≤—Å–µ—Ö –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ–π).
*   **Stem (—Å—Ç–µ–º):** *structure*. –ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–∞–¥–∞, —Å–æ–µ–¥–∏–Ω—è—é—â–∞—è –≤–µ—Ä—à–∏–Ω—É –∏ –≥–ª—É–±–∏–Ω—É.
*   **Stem Pruning (—Å—Ç–µ–º-–ø—Ä—É–Ω–∏–Ω–≥):** *algo*. –ú–µ—Ç–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –ø—É—Ç–µ–º –æ—Ç—Å–µ—á–µ–Ω–∏—è "—à—É–º–Ω—ã—Ö" –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ–π.
*   **Umbral Modes (—É–º–±—Ä–∞–ª—å–Ω—ã–µ –ª–∞–¥—ã):** *output*. –†–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–µ –∑–≤—É–∫–æ—Ä—è–¥—ã (—Å—É—â–Ω–æ—Å—Ç–Ω–æ ‚Äî –º–∏–Ω–æ—Ä–Ω—ã–µ/–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ), –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ –æ–∫—Ç–∞–≤—É.

### 3. –ê–ª–≥–æ—Ä–∏—Ç–º: Stem Pruning (v3.0 Logic)
–°–∏—Å—Ç–µ–º–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–ø–∞—Ä–Ω–æ–≥–æ –∫–æ–Ω—Å–æ–Ω–∞–Ω—Å–∞ –∏–ª–∏ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å—Ç—ã—Ö —á–∏—Å–µ–ª (–≠–π–ª–µ—Ä, –ú—É—Ä–∑–∏–Ω –∏ —Ç.–¥.). –¢–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
*   `pool_size`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ—Ä—à–∏–Ω –∏ –∏—Å—Ö–æ–¥–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ–π (–æ–±—ã—á–Ω–æ 32-64).
*   `max_resolution`: –õ–∏–º–∏—Ç –≥–ª—É–±–∏–Ω—ã (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–Ω—è). –ü—Ä–∏–º–µ—Ä: `2520` (7-limit), `5040`.

**–¶–∏–∫–ª —Ä–∞–±–æ—Ç—ã:**
1.  **Shadow Projection:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º "—Å—ã—Ä—É—é –º–∞—Å—Å—É".
    *   –î–ª—è –∫–∞–∂–¥–æ–π *Apex* (–æ—Ç 1 –¥–æ `pool_size`):
    *   –°–æ–∑–¥–∞–µ–º —Ä—è–¥ –¥—Ä–æ–±–µ–π `Apex / n`, –≥–¥–µ `n` –æ—Ç 1 –¥–æ `pool_size`. (–î—Ä–æ–±–∏ —Å—Ä–∞–∑—É —Å–æ–∫—Ä–∞—â–∞—é—Ç—Å—è: `3/6` -> `1/2`).
2.  **Analysis:** –°—á–∏—Ç–∞–µ–º —Ç–µ–∫—É—â–∏–π `System Root` (GCD –≤—Å–µ—Ö –Ω–æ—Ç –≤–æ –≤—Å–µ—Ö –ª–∞–¥–∞—Ö).
    *   *Math:* $GCD(n_1/d_1, n_2/d_2) = \frac{gcd(n_1, n_2)}{lcm(d_1, d_2)}$.
    *   *Depth* = –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å —ç—Ç–æ–≥–æ System Root.
    *   *–í–∞–∂–Ω–æ:* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **BigInt**! –ó–Ω–∞—á–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ.
3.  **Check:** –ï—Å–ª–∏ `Depth <= max_resolution`, –≤–µ—Ä–Ω—É—Ç—å —Å–∏—Å—Ç–µ–º—É.
4.  **Identification (The Heuristic):**
    *   –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã.
    *   **CRITICAL:** –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö –ø–æ **—É–±—ã–≤–∞–Ω–∏—é** (`desc`). –ú—ã –æ–±—è–∑–∞–Ω—ã —É–¥–∞–ª—è—Ç—å –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞ (—à—É–º) —Ä–∞–Ω—å—à–µ –º–∞–ª—ã—Ö (–º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã), –µ—Å–ª–∏ –æ–Ω–∏ –≤–Ω–æ—Å—è—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤–∫–ª–∞–¥ –≤ "—Ä–∞–∑–¥—É–≤–∞–Ω–∏–µ" –≥–ª—É–±–∏–Ω—ã.
    *   –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –≤—ã—á–∏—Å–ª—è–µ–º: "–ö–∞–∫–æ–≤–∞ –±—É–¥–µ—Ç `Depth`, –µ—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å?".
    *   –í—ã–±–∏—Ä–∞–µ–º "–ñ–µ—Ä—Ç–≤—É" ‚Äî –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å, —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –¥–∞–µ—Ç **–º–∏–Ω–∏–º–∞–ª—å–Ω—É—é** –Ω–æ–≤—É—é –≥–ª—É–±–∏–Ω—É (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π GCD).
5.  **Pruning:** –£–¥–∞–ª—è–µ–º –Ω–æ—Ç—ã —Å —ç—Ç–∏–º –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ–º –∏–∑ *–≤—Å–µ—Ö* –ª–∞–¥–æ–≤.
6.  **Recursion:** –ü–æ–≤—Ç–æ—Ä—è–µ–º —Å —à–∞–≥–∞ 2.

### 4. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω—é–∞–Ω—Å—ã –∏ "Gotchas"

1.  **BigInt Necessity:** –í JS –Ω–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ GCD –¥–ª—è –¥—Ä–æ–±–µ–π, –∞ `Math` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å float64. –í—Å—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–≤–∫–ª—é—á–∞—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ `lcm`) –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ –Ω–∞ `BigInt`.
2.  **Rational Simplification:** Julia –¥–µ–ª–∞–µ—Ç `simplify` (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –í JS –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥—Ä–æ–±–∏ `Apex/n` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å—Ä–∞–∑—É –¥–µ–ª–∞—Ç—å —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ GCD, –∏–Ω–∞—á–µ –∞–ª–≥–æ—Ä–∏—Ç–º –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å –ª–æ–∂–Ω—ã–µ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `2/4` –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å `1/2` –¥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –ø—É–ª –∞–Ω–∞–ª–∏–∑–∞).
3.  **"Curse of 1/1":** –õ–∞–¥ —Å *Apex*=1 –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç —Å–∞–º—ã–º –±–µ–¥–Ω—ã–º (—Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ 1/1, 1/2...). –≠—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ (—á–µ–º –≤—ã—à–µ –≤–µ—Ä—à–∏–Ω–∞, —Ç–µ–º –±–æ–≥–∞—á–µ –≥–∞—Ä–º–æ–Ω–∏—è). –ù–µ –ø—ã—Ç–∞—Ç—å—Å—è –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å.
4.  **Empty Scales:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä—É–Ω–∏–Ω–≥–∞ –ª–∞–¥ –º–æ–∂–µ—Ç –æ–ø—É—Å—Ç–µ—Ç—å (–æ—Å—Ç–∞—Ç—å—Å—è < 3 –Ω–æ—Ç). –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–∏–µ –ª–∞–¥—ã –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º —Ä–µ–∫—É—Ä—Å–∏–∏.

### 5. –°—Ç–µ–∫ –∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

*   **Core Lib:** `ji-lib-core.js` (Readonly). –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ `RationalInterval` –∏ —É—Ç–∏–ª–∏—Ç.
*   **Gen Module:** –ü–∏—à–µ–º –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `ji-gen-stem.js`.
    *   –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `BigIntMath` (`gcd`, `lcm`).
    *   –§—É–Ω–∫—Ü–∏—è `generateSystem(config)`.
    *   –§—É–Ω–∫—Ü–∏—è `transformView(system, mode)`.

### 6. –†–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (View Modes)

1.  **Relative (–û—Å–Ω–æ–≤–Ω–æ–π):** –õ–∞–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–≤–æ–µ–π –≤–µ—Ä—à–∏–Ω—ã, –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤ –æ–∫—Ç–∞–≤—É.
    *   –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "–û–∫—Ä–∞—Å–∫—É –ª–∞–¥–∞" (e.g., Phrygian flavor).
    *   Formula: `normalize(note / apex)`.
2.  **Harmonic (–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π):** –í—Å–µ –Ω–æ—Ç—ã –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ –æ–±—â–µ–º—É –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—é (–≥–ª—É–±–∏–Ω–µ).
    *   –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "–ü–æ–∑–∏—Ü–∏—é –Ω–∞ –µ–¥–∏–Ω–æ–π —á–∞—Å—Ç–æ—Ç–Ω–æ–π —Å–µ—Ç–∫–µ".
    *   Formula: `note / SystemRoot`.
3.  **Absolute (–°—ã—Ä–æ–π):** –ò—Å—Ö–æ–¥–Ω—ã–µ –¥—Ä–æ–±–∏ `Apex/n` (—Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–µ).

---
*–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—é. Julia-–ø—Ä–æ—Ç–æ—Ç–∏–ø —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (v1.0).*