# Записки о музыкальной арифметике: путешествие к гармонии через код

## Введение: Музыка, математика и код

Наука только тогда достигает совершенства, когда ей удаётся пользоваться математикой.
К. Маркс (1818- 1883)

Музыка – это язык, понятный каждому. Она способна вызывать у нас радость и грусть, успокаивать и волновать, переносить в иные миры. Но из чего же она сделана? Как рождается гармония – это чарующее созвучие, которое так ласкает наш слух?

Веками люди пытались разгадать секрет музыкальной гармонии. Пифагор, играя на монохорде, обнаружил удивительную связь между длиной струны и высотой звука. Оказалось, что простые математические отношения, "красивые" дроби, лежат в основе благозвучия. Так родилась идея о том, что музыка – это не просто искусство, но и точная наука, и что за внешней красотой скрываются строгие математические законы.

Сегодня, в эпоху цифровых технологий, мы можем не только исследовать эти законы, но и использовать их для создания новых музыкальных форм. Вооружившись языком программирования Julia, мы отправимся в увлекательное путешествие – от основ музыкальной теории к алгоритмам, генерирующим гармонические структуры. Мы заглянем внутрь звука, увидим, как рождается консонанс, и научимся управлять гармонией с помощью кода.

## I. Звук как сумма гармоник: из чего сделана музыка

Представьте себе гитарную струну. Вы дёргаете её, и она начинает вибрировать, издавая звук. Но что, если я скажу вам, что этот звук – не просто одно колебание, а целая симфония невидимых глазу волн?

**Сделаем простой эксперимент:**

1. Извлеките звук из любой струны, например, гитарной.
2. Слегка приглушите её пальцем ровно посередине (на гитаре это 12-й лад). Вы услышите, как звук изменится, станет более высоким и "прозрачным".
3. Повторите эксперимент, приглушив струну в точке, делящей её на три части (7-й или 19-й лад). Звук снова изменится.
4. Можно продолжить, деля струну на 4, 5 и более частей.

Что же происходит? Прикасаясь к струне, вы не создаёте новые звуки, а лишь *фильтруете* уже существующие. Вы гасите одни колебания, позволяя другим звучать более отчётливо.

**Секрет прост: музыкальный звук – это не единая волна, а сумма множества колебаний, называемых гармониками (или обертонами).**

**Что такое гармоники?**

*   **Основной тон:** Самое низкое и громкое колебание. Именно его высоту мы воспринимаем как высоту звука.
*   **Обертоны (гармоники):** Более высокие и тихие призвуки. Их частоты *кратны* частоте основного тона (в 2 раза выше, в 3 раза выше, в 4 раза выше и т.д.).

**Визуализация: смотрим на звук**

<iframe src="interactive_oscilloscope.html" width="800" height="400">Ваш браузер не поддерживает iframe</iframe>

*Комментарий: Здесь интерактивный пример с осциллоскопом. Можно включить разные гармоники (синусоиды) с разными амплитудами и увидеть, как они складываются в итоговую форму волны. Это наглядно покажет, что музыкальный звук – это сумма гармоник.*

**Музыкальный звук — это сумма стоячих волн (или гармоник), частоты которых кратны частоте основного тона.** Каждая гармоника — это по сути отдельный звук (тон), со своей частотой и громкостью (амплитудой). И хотя основной тон, как правило, самый громкий, именно уникальное сочетание гармоник, их относительная громкость, формирует неповторимый **тембр** каждого инструмента или голоса.

**Почему мы не слышим обертоны по отдельности?**

Потому что наш мозг проделывает удивительную работу: он объединяет все эти колебания в единый звуковой образ. Мы воспринимаем не отдельные гармоники, а целостный звук, окрашенный их уникальным сочетанием.

**Немного математики:**

Если частота основного тона равна *f*, то частоты обертонов будут *2f, 3f, 4f, 5f* и так далее. Это можно представить в виде ряда:

`f, 2f, 3f, 4f, 5f, ...`

**Значение обертонов:**

Обертоны – это не просто "побочный эффект" колебаний. Они играют важнейшую роль в музыке:

*   **Определяют тембр:** Разные инструменты имеют разный набор обертонов, что и придаёт им уникальное звучание.
*   **Влияют на консонанс:** О том, как именно, мы поговорим чуть позже.

**Вывод:** Звук – это не просто волна, а сложная структура, состоящая из множества гармоник. Понимание этого факта – первый шаг на пути к разгадке тайны музыкальной гармонии.

## II. Математика консонанса: гармония чисел

Итак, мы выяснили, что музыкальный звук – это "коктейль" из гармоник. Но почему одни сочетания звуков кажутся нам приятными, а другие – нет? Почему одни звуки "дружат", а другие "враждуют"?

**Консонанс и диссонанс: созвучие и противоречие**

**Консонанс** – это благозвучие, слияние звуков, ощущение гармонии и покоя. **Диссонанс** – наоборот, напряжение, резкость, дискомфорт.

**Примеры:**

*   Октава (2:1), квинта (3:2), кварта (4:3) – классические примеры консонансов.
*   Секунда (9:8), тритон (45:32) – диссонансы.

**В чём же секрет? Почему одни интервалы звучат приятно, а другие – нет?**

**Секрет – в совпадении гармоник!**

Когда два звука консонируют, их гармоники часто совпадают или находятся в простых, "красивых" отношениях друг к другу.

**Как это работает?**

Возьмём для примера **квинту** – один из самых консонансных интервалов. Отношение частот в квинте 3:2. Это значит, что если нижний звук имеет частоту *f*, то верхний – *1.5f*.

А теперь посмотрим на их обертоны:

*   **Нижний звук:** *f, 2f, 3f, 4f, 5f, 6f, ...*
*   **Верхний звук:** *1.5f, 3f, 4.5f, 6f, 7.5f, 9f, ...*

Видите? **Каждый второй обертон верхнего звука (3f, 6f, 9f...) совпадает с каждым третьим обертоном нижнего звука!**

**Иллюстрация: совпадение гармоник**

<iframe src="harmonics_visualizer.html" width="800" height="400">Ваш браузер не поддерживает iframe</iframe>

*Комментарий: Здесь визуализатор гармоник на спектрограмме. Можно выбрать два звука, и программа выделит совпадающие гармоники. Наглядно видно, что у консонансных интервалов (октава, квинта, кварта) много совпадений.*

**Чем больше совпадений – тем консонантее интервал.**

**Формула консонанса: математический расчёт**

Консонанс можно даже измерить! Для оценки консонанса интервала между нотами, выраженного отношением *m/n*, Евгений Мурзин предложил формулу *1/m + 1/n*:

```julia
function consonance(ratio::Rational{Int})::Float64
    Float64(denominator(ratio)^-1 + numerator(ratio)^-1)
end
```

Она, по сути, показывает **процент совпадающих гармоник**. Чем меньше числа *m* и *n*, тем больше совпадений и тем выше значение консонанса.

**Примеры:**

```julia
println("Консонанс октавы (2/1): ", consonance(2//1)) # 1/2 + 1/1 = 1.5
println("Консонанс квинты (3/2): ", consonance(3//2)) # 1/3 + 1/2 = 0.833
println("Консонанс большой терции (5/4): ", consonance(5//4)) # 1/5 + 1/4 = 0.45
println("Консонанс малой терции (6/5): ", consonance(6//5)) # 1/6 + 1/5 = 0.367
```

**Гармоническая энтропия: сложность созвучия**

Помимо совпадения гармоник, на наше восприятие консонанса влияет и **гармоническая энтропия**. Это понятие из теории информации, которое в данном случае отражает **сложность соотношения частот**. Чем проще соотношение (меньше числа в числителе и знаменателе дроби), тем ниже энтропия и тем более консонансным кажется нам созвучие.

**Интерактивный пример: гармоническая энтропия**

<iframe src="entropy_visualizer.html" width="800" height="400">Ваш браузер не поддерживает iframe</iframe>

*Комментарий: Здесь интерактивный пример с визуализацией гармонической энтропии. Можно менять соотношение частот (дроби) и наблюдать, как меняется энтропия, а также видеть положение точки на графике, отражающем результаты эмпирических исследований.*

**Исследования показывают, что гармоническая энтропия и субъективное восприятие консонанса тесно связаны.**

**Вывод:** Консонанс – это не магия, а математика! Совпадение гармоник и простота соотношений частот – вот ключ к благозвучию.

## III. Основы музыкальной арифметики: интервалы и их сложение

Теперь, когда мы понимаем, что такое консонанс и откуда он берётся, давайте научимся оперировать с музыкальными интервалами. Ведь именно из них, как из кирпичиков, складывается здание гармонии.

**Интервал – это отношение частот двух звуков.**

Например:

*   **Октава:** отношение 2:1 (верхний звук в два раза выше нижнего)
*   **Квинта:** отношение 3:2 (верхний звук в полтора раза выше нижнего)
*   **Большая терция:** отношение 5:4 (верхний звук в 1.25 раза выше нижнего)

**Сложение интервалов: перемножаем отношения**

Чтобы сложить два интервала, нужно **перемножить** их частотные отношения.

**Пример:**

Допустим, мы хотим сложить большую терцию (5/4) и малую терцию (6/5).

*   Перемножаем: (5/4) \* (6/5) = 30/20
*   Сокращаем дробь: 30/20 = 3/2
*   Получаем: **квинта** (3/2)

**То есть, большая терция плюс малая терция равна квинте.**

**Вычитание интервалов: делим отношения**

Чтобы вычесть один интервал из другого, нужно **разделить** большее отношение на меньшее.

**Пример:**

Допустим, мы хотим вычесть большую терцию (5/4) из квинты (3/2).

*   Делим: (3/2) : (5/4) = (3/2) \* (4/5) = 12/10
*   Сокращаем дробь: 12/10 = 6/5
*   Получаем: **малая терция** (6/5)

**То есть, квинта минус большая терция равна малой терции.**

**Полутоны и центы: точное измерение**

Для более точного измерения интервалов используются **полутоны** и **центы**.

*   **Полутон:** наименьший интервал в равномерно темперированном строе (12-EDO), где октава делится на 12 равных частей.
*   **Цент:** одна сотая полутона (1/1200 октавы).

**Перевод отношений в центы:**

```julia
function ratio_to_cents(ratio::Rational{Int})
    1200 * log2(ratio)
end

# Примеры:
major_third = 5//4
minor_third = 6//5
perfect_fifth = 3//2

println("Большая терция: ", round(ratio_to_cents(major_third)), " центов") # ~386 центов
println("Малая терция: ", round(ratio_to_cents(minor_third)), " центов") # ~316 центов
println("Квинта: ", round(ratio_to_cents(perfect_fifth)), " центов") # ~702 цента
```

**Сложение и вычитание в центах:**

Зная количество центов в каждом интервале, можно складывать и вычитать их, как обычные числа.

**Пример:**

```julia
println("Большая терция + малая терция = квинта: ", round(ratio_to_cents(major_third)) + round(ratio_to_cents(minor_third)) ≈ round(ratio_to_cents(perfect_fifth)))
println("Квинта - большая терция = малая терция: ", round(ratio_to_cents(perfect_fifth)) - round(ratio_to_cents(major_third)) ≈ round(ratio_to_cents(minor_third)))
```

**Нахождение интервала между нотами:**

Чтобы найти интервал между двумя нотами, представленными в виде отношений, нужно разделить большее отношение на меньшее.

**Примеры:**

*   Между нотами 5/4 и 3/2 интервал равен 3/2 : 5/4 = 3/2 \* 4/5 = 6/5 (малая терция).
*   Между нотами 9/8 и 4/3 интервал равен 4/3 : 9/8 = 4/3 \* 8/9 = 32/27.

**Вывод:** Умение складывать и вычитать интервалы – это основа музыкальноого мышления через натуральные отношения звуков. Зная эти простые правила, мы можем анализировать созвучия, строить аккорды и лады, сочинять музыку, руководствуясь не только интуицией, но и точным расчётом.

**Продолжение следует...**

В следующей части мы поговорим об **акустической тонике** – невидимом фундаменте, на котором строится здание гармонии. Мы узнаем, как её найти и как она помогает создавать новые музыкальные лады. А дальше – окунёмся в мир **программирования** и научимся генерировать гармонические структуры с помощью кода!



## IV. Акустическая тоника: скрытый стержень гармонии

До этого мы рассматривали отдельные звуки и интервалы. Но в музыке, как правило, звучит не один звук и не два, а множество. И чтобы вся эта звуковая палитра не превратилась в хаос, нужен какой-то организующий принцип, точка отсчёта, центр притяжения. Эту роль выполняет **тоника** - главная нота лада, к которой тяготеют все остальные.

Но что, если пойти ещё дальше? Что, если у самой тоники есть своя "прародительница"? Некий ещё более глубокий уровень гармонической организации?

**Встречайте: акустическая тоника!**

Это не какой-то реально звучащий звук, не нота, которую можно сыграть на инструменте. **Акустическая тоника - это математическая абстракция, невидимый стержень, вокруг которого выстраивается вся система гармонических отношений.** Это - **общий знаменатель** для всех частот, используемых в музыкальном произведении или его фрагменте.

**Как найти акустическую тонику?**

Для этого нам понадобится знание о **наименьшем общем знаменателе (НОЗ)**.

**Алгоритм:**

1. Берём набор нот, которые используются в музыкальном фрагменте. Каждая нота выражена в виде отношения к некоторой условной тонике (пока не важно, какой именно).
2. Раскладываем знаменатели этих отношений на простые множители.
3. Находим НОЗ, перемножая все простые множители в их максимальных степенях.
4. Полученный НОЗ - это знаменатель акустической тоники. Сама акустическая тоника выражается дробью 1/НОЗ.

**Примеры:**

1. Допустим, у нас есть три ноты: 4/3, 6/5 и 3/2.
    *   Разложим знаменатели на простые множители: 3 = 3, 5 = 5, 2 = 2.
    *   НОЗ = 2 \* 3 \* 5 = 30.
    *   Акустическая тоника = 1/30.

2. Другой набор нот: 16/9, 16/15 и 4/3.
    *   Разложим знаменатели: 9 = 3\*3, 15 = 3\*5, 3 = 3.
    *   НОЗ = 3\*3\*5 = 45.
    *   Акустическая тоника = 1/45.

3. Ещё пример: 15/4, 16/9 и 27/16.
    *   Знаменатели: 4 = 2\*2, 9 = 3\*3, 16 = 2\*2\*2\*2.
    *   Ищем НОЗ, *игнорируя степени двойки*, так как они отвечают за октавное положение ноты, а не за её гармоническую функцию: НОЗ(1, 9, 1) = 9.
    *   Акустическая тоника (после "спуска" условной тоники): 1/9.
    *   Теперь каждую ноту можно представить как обертон этой тоники:
        *   15/4 -> (15/4) / (1/9) = 135/4 (135-й обертон тоники 1/9, приведённый к октаве делением на подходящую степень двойки)
        *   16/9 -> (16/9) / (1/9) = 16/1 (16-й обертон тоники 1/9)
        *   27/16 -> (27/16) / (1/9) = 243/16 (243-й обертон тоники 1/9, приведённый к октаве)

**Зачем нужна акустическая тоника?**

*   **Единая система координат:** Она задаёт единую систему координат для всех звуков в музыкальном фрагменте. Все ноты можно представить как обертоны акустической тоники, что упрощает анализ их взаимосвязей и гармонических функций.
*   **Скрытая гармоническая основа:** Акустическая тоника не обязана реально звучать в произведении,

Верно, акустическая тоника может как совпадать, так и не совпадать с традиционной тоникой, воспринимаемой на слух. Это важный момент. Продолжаем.

**Зачем нужна акустическая тоника?**

*   **Единая система координат:** Она задаёт единую систему координат для всех звуков в музыкальном фрагменте. Все ноты можно представить как обертоны акустической тоники, что упрощает анализ их взаимосвязей и гармонических функций.
*   **Скрытая гармоническая основа:** Акустическая тоника не обязана реально звучать в произведении, но она незримо присутствует, организуя гармоническое пространство. Она как гравитационный центр, вокруг которого вращаются все остальные звуки, даже если этот центр скрыт от глаз (ушей).
*   **Основа для построения ладов:** Акустическая тоника открывает путь к созданию новых музыкальных ладов, основанных на натуральных отношениях звуков. Об этом мы поговорим подробнее в следующих разделах.
*   **Инструмент анализа:** Позволяет глубже понять гармоническую структуру произведения, выявить скрытые связи между звуками.

**Акустическая тоника и традиционная тоника: в чём разница?**

*   **Традиционная тоника** - это та нота, которая воспринимается на слух как тональный центр, как точка опоры и разрешения. Она, как правило, явно звучит в произведении, к ней тяготеют другие ступени лада.
*   **Акустическая тоника** - это математически вычисленный общий знаменатель для всех частот, используемых в музыкальном фрагменте. Она может совпадать с традиционной тоникой, а может и не совпадать.

**Пример:**

Представьте себе мажорный лад. Традиционная тоника – это первая ступень лада. А вот акустической тоникой может быть, например, 1/9, а сама тоника, которую мы слышим, может быть представлена как 9/9, то есть, 9-й обертон акустической тоники 1/9.

**Практическое применение:**

Понимание концепции акустической тоники даёт нам мощный инструмент для:

*   **Анализа гармонии:** Мы можем разложить любое созвучие или последовательность звуков на составляющие, определить их отношения к акустической тонике и понять, как они связаны между собой.
*   **Создания новых гармоний:** Мы можем использовать акустическую тонику как основу для построения новых ладов и аккордов, исследуя натуральные звукоряды и открывая неизведанные гармонические пространства.
*   **Генерации музыкальных структур:** Используя алгоритмы, основанные на принципах акустической тоники, мы можем создавать целые музыкальные произведения, управляя гармонией с помощью кода.

**Вывод:**

Акустическая тоника – это не просто умозрительная конструкция, а мощный инструмент гармонического мышления. Она позволяет нам видеть музыку не как набор разрозненных звуков, а как единую систему, основанную на строгих математических законах. И пусть она не всегда слышна уху, её организующая сила пронизывает всю ткань музыкального произведения.

**Далее мы перейдём к самому интересному – к практическому применению этих знаний. Мы научимся использовать язык программирования Julia для того, чтобы генерировать музыкальные структуры, основанные на принципах, которые мы только что изучили. Приготовьтесь, мы отправляемся в мир музыкальной математики и кода!**



**Практический смысл:** Акустическая тоника - это не просто абстрактная идея, это мощный инструмент для анализа и синтеза музыки. Позже мы увидим, как она помогает строить необычные и красивые лады.

## V. Унтертоны: зазеркалье гармонии

Мы уже знаем, что у каждого звука есть "свита" из **обертонов** – высших призвуков, чьи частоты кратны основному тону. Но что, если мы заглянем по другую сторону "зеркала" и посмотрим на звуки, чьи частоты, наоборот, являются *делителями* частоты основного тона?

**Встречайте: унтертоны!**

Если основной тон имеет частоту *f*, то унтертоны – это *f/2, f/3, f/4, f/5*...

**Важное отличие:** Обертоны — это реальные призвуки, которые мы можем услышать в спектре звука. **Унтертоны же — это скорее умозрительная конструкция, математическая абстракция.** В реальных звуках они или отсутствуют, или едва заметны.

**Главное свойство унтертонов:**

**Унтертон данной ноты – это такой звук, для которого \*эта нота\* является \*обертоном\*.**

То есть, если X — унтертон Y, то Y входит в *обертоновый ряд* X.

**Примеры:**

- 
- F (фа) – унтертон C (до), потому что C – это 3-й обертон F.
- Если взять за тонику C (допустим, 100 Гц), то её третьим унтертоном будет F (33.33 Гц), и C (100 Гц) будет третьим обертоном этой F.

**Унтертоника: особая роль**

В нашем исследовании **унтертоника** — это не просто любой унтертон, а **унтертон, взятый от одного из обертонов \*акустической тоники\***. Она — отправная точка для построения особенных музыкальных ладов.

**Математика унтертоники:**

Если акустическая тоника — 1/T, а её n-й обертон выбран как унтертоника, то унтертоника — n/T. Унтертоновый ряд строится делением: n/T, n/(2T), n/(3T), n/(4T)...

**Пример:**

- 
- Акустическая тоника: 1/45
- Унтертоника: 5/45 (5-й обертон)
- Унтертоновый ряд: 5/45, 5/90, 5/135, 5/180...

**Зачем нужны унтертоны?**

- 
- Они помогают понять глубинные связи между звуками.
- Они открывают путь к созданию новых, удивительных музыкальных ладов, основанных на *обертонах*.
- Они позволяют создавать гармонии, объединенные общей *акустической тоникой*, но при этом разнообразные по своему звучанию.

**Практический смысл:** Унтертоны и унтертоника – это инструменты для создания полимодальных гармоний, где каждый голос может жить в своем ладу, но все они связаны общей "прародительницей" – акустической тоникой.

**Дальше мы вооружимся этими знаниями и начнём программировать музыку, создавать свои собственные гармонические вселенные!**







#### Умножение и деление: основа основ

Когда мы говорим о музыкальных интервалах, мы подразумеваем **отношения частот**. Например, интервал квинты (3/2) означает, что верхний звук имеет частоту в 3/2 раза *больше*, чем нижний. Поэтому, чтобы **сложить** два интервала, мы должны **перемножить** их отношения:

**Пример:**

*   Большая терция (5/4) + малая терция (6/5) = квинта (3/2)
*   Математически: 5/4 \* 6/5 = 30/20 = 3/2

Чтобы **вычесть** один интервал из другого, нужно **разделить** большее отношение на меньшее:

**Пример:**

*   Квинта (3/2) - большая терция (5/4) = малая терция (6/5)
*   Математически: 3/2 : 5/4 = 3/2 \* 4/5 = 12/10 = 6/5

#### Логарифмическая шкала: полутоны и центы

В музыке часто используется логарифмическая шкала для измерения интервалов. Это связано с тем, что наше ухо воспринимает высоту звука логарифмически. В этой шкале используются **полутоны** и **центы**.

*   **Полутон** – это наименьший интервал в равномерно темперированном строе (12-EDO), где октава делится на 12 равных частей.
*   **Цент** – это одна сотая полутона (1/1200 октавы).

В логарифмической шкале **сложение** интервалов соответствует **сложению** их значений в полутонах или центах, а **вычитание** – **вычитанию**.

**Пример:**

*   Большая терция (4 полутона) + малая терция (3 полутона) = квинта (7 полутонов)
*   Квинта (702 цента) - большая терция (386 центов) = малая терция (316 центов)

```julia
# Функция для преобразования частотного отношения в центы:
function ratio_to_cents(ratio::Rational{Int})
    1200 * log2(ratio)
end

# Пример:
major_third = 5//4
minor_third = 6//5
perfect_fifth = 3//2

println("Большая терция: ", round(ratio_to_cents(major_third)), " центов")
println("Малая терция: ", round(ratio_to_cents(minor_third)), " центов")
println("Квинта: ", round(ratio_to_cents(perfect_fifth)), " центов")

println("Большая терция + малая терция = квинта: ", round(ratio_to_cents(major_third)) + round(ratio_to_cents(minor_third)) == round(ratio_to_cents(perfect_fifth)))
println("Квинта - большая терция = малая терция: ", round(ratio_to_cents(perfect_fifth)) - round(ratio_to_cents(major_third)) == round(ratio_to_cents(minor_third)))
```

#### Нахождение интервала между нотами

Чтобы найти интервал между двумя нотами, представленными в виде отношений (дробей), нужно разделить большее отношение на меньшее.

**Пример:**

*   Найти интервал между нотами 5/4 и 3/2.
*   Решение: 3/2 : 5/4 = 3/2 \* 4/5 = 12/10 = 6/5 (малая терция)

#### Вычисление акустической тоники

**Акустическая тоника** - это основа всей гармонической системы, самый низкий звук, *общий знаменатель* для всех используемых нот. Она вычисляется на основе **наименьшего общего знаменателя (НОЗ)** частотных отношений тех нот, которые мы хотим использовать.

**Пример 1:**

*   Мы хотим использовать ноты с отношениями 4/3 и 6/5.
*   Находим НОЗ для знаменателей 3 и 5: НОЗ(3, 5) = 15.
*   Следовательно, акустическая тоника будет иметь отношение 1/15.

**Пример 2:**

*   Мы хотим использовать ноты с отношениями 16/9 и 16/15.
*   Представляем знаменатели в виде произведения простых множителей: 9 = 3\*3, 15 = 3\*5.
*   НОЗ будет включать максимальное количество каждого простого множителя: 3\*3\*5 = 45.
*   Следовательно, акустическая тоника будет иметь отношение 1/45.

**Пример 3 (более сложный):**

Допустим, у нас есть три ноты, отношения которых к некой условной тонике (которую мы пока НЕ ищем) равны 15/4, 16/9, и 27/16.
* Находим НОЗ для знаменателей: 4 = 2\*2, 9 = 3\*3, 16 = 2\*2\*2\*2. НОЗ = 2\*2\*2\*2\*3\*3 = 144.
* То есть, самая низкая общая гармоника для этих трех нот имеет частотное отношение 1/144 по отношению к нашей условной тонике.
* Это значит, что каждая из этих нот может быть представлена в виде дроби, где числитель — это номер её обертона, а знаменатель — 144. Например, 15/4 можно представить как 540/144 (домножив и числитель, и знаменатель на 36), то есть, это 540-й обертон тоники 1/144.

**Важное замечание:** Акустическая тоника не обязана реально звучать в произведении. Она - скорее, математическая абстракция, основа гармонического "фундамента".

#### Обертоны акустической тоники

Обертоны акустической тоники - это звуки, частоты которых кратно *выше* частоты акустической тоники. Если отношение акустической тоники 1/45, то её обертоны будут 2/45, 3/45, 4/45, 5/45 и т.д.

#### Кратко об унтертонах и унтертонике

*   **Унтертоны** строятся от **унтертоники** - звука, который сам является *обертоном* акустической тоники.
*   **Унтертоника** - это "перевернутая тоника", точка отсчета для построения унтертонового ряда в рамках лада.

Более подробно про унтертоны и унтертонику мы поговорим в разделе, посвященном построению ладов.



## Арифметика гармонии: выводим мажорный лад (и не только) из естественных ограничений

Музыка — это не просто набор звуков. Это вибрация, резонирующая с нашей душой, универсальный язык, способный передавать эмоции и идеи без слов. С древних времен люди стремились разгадать тайны музыкальной гармонии. Это путешествие привело нас от экспериментов Пифагора с монохордом до современных алгоритмов, способных генерировать гармонические структуры с математической точностью. В этой статье мы  не просто рассмотрим теорию, но и научимся самостоятельно создавать музыкальные лады, используя язык программирования Julia. Этот метод позволит нам  экспериментировать с новыми строями  и  понимать глубинную структуру музыки.



### Шаг 3:  Строим фундамент – допустимые интервалы

Теперь  перейдем  к  практике. Первым  шагом  будет  создание  набора  допустимых  интервалов,  из  которых  мы  будем  строить  лады.

```julia
using Combinatorics
using Primes

# Генерация всех возможных интервалов (дробей) до 45/45
base_ratios = Rational{Int}[y // x for (x, y) in combinations(1:45, 2)]
```

Мы  генерируем  все  возможные  дроби,  где  числитель  и  знаменатель  не  превышают  45,  аналогично  тому,  как  Пифагор  экспериментировал  с  разными  делениями  струны  на  монохорде. В  его  экспериментах  длина  струны,  деленная  на  целое  число  или  его  долю,  определяла  высоту  звука.

```julia
# Фильтрация отношений по odd_limit
odd_limit(limit::Int, ratio::Rational{Int}) = numerator(ratio) <= limit && denominator(ratio) <= limit
filtered_by_odd_limit = filter(r -> odd_limit(32, r), base_ratios)

# Фильтрация отношений по prime_limit
prime_limit(ratio::Rational{Int}) = begin
    ispow2(denominator(ratio)) || return false
    factors = Primes.factor(Vector, numerator(ratio))
    count(==(3), factors) <= 4 && count(>=(5), factors) <= 2 && count(>=(7), factors) <= 1
end
filtered_ratios = filter(prime_limit, filtered_by_odd_limit)

```

Затем фильтруем эти дроби,  используя  `odd_limit` и  `prime_limit`.   `odd_limit`  ограничивает  величину  числителя  и  знаменателя (не более 32),  чтобы  избежать  слишком  сложных  соотношений.   `prime_limit`  ограничивает  использование  простых  множителей  в  числителе,  отдавая  предпочтение  интервалам,  близким  к  гармоническому  ряду.   

**Более подробное объяснение prime limit и odd limit:**

Важно не просто привести код, но и объяснить, *почему* мы используем эти ограничения.

- **Odd Limit:** Ограничивая числитель и знаменатель дроби, мы избегаем слишком сложных соотношений частот, которые трудны для восприятия и интонирования. Это также делает вычисления более эффективными. В нашем случае, предел равен 32, что позволяет включить большинство важных музыкальных интервалов.
- **Prime Limit:** Ограничивая набор простых множителей в числителе дроби числами 2, 3, 5 и 7 (с определенными дополнительными ограничениями), мы отдаем предпочтение интервалам, близким к гармоническому ряду. Это обусловлено тем, что гармонический ряд играет фундаментальную роль в нашем восприятии гармонии. Ограничения на количество 3, 5 и 7 в числителе необходимы, чтобы избежать слишком сложных и диссонирующих интервалов.

После  фильтрации  мы  нормализуем  интервалы  к  октаве  и  удаляем  дубликаты. Затем  выводим  таблицу  интервалов  с  их  названиями  и  величиной  в  центах. (Заполнение  названий  интервалов  в  таблице  остается  ручной  работой,  так  как  не  все  дроби  соответствуют  стандартным  названиям  интервалов).

```julia
# Нормализация интервалов к октаве и удаление дубликатов
normalize_to_octave(ratio::Rational{Int}) = ratio / (2//1)^floor(Int, log2(ratio))
intervals = unique(normalize_to_octave.(filtered_ratios))

# Вывод таблицы интервалов
println("Допустимые интервалы:")
for interval in intervals
    cents = round(1200 * log2(interval), digits=2)
    name = "" # Здесь нужно добавить названия интервалов
    println("$interval \t $cents ц. \t $name")
end
```



**Таблица интервалов (пример):**

| Дробь | Центы  | Название интервала            |
| ----- | ------ | ----------------------------- |
| 1//1  | 0      | Унисон                        |
| 3//2  | 701.96 | Квинта                        |
| 5//4  | 386.31 | Большая терция                |
| 7//4  | 968.83 | Малая септима (гармоническая) |
| ...   | ...    | ...                           |




### Шаг 4:  Построение ладов:  полный перебор

Теперь,  имея  набор  допустимых  интервалов,  мы  можем  приступить  к  построению  ладов.   Мы  будем  использовать  алгоритм  полного  перебора,  постепенно  увеличивая  число  нот  в  ладу.

```julia
# ... (определение типов данных Scale, ScaleWithConsonance, ScaleDatabase)

function insert_scale!(scales::Vector{ScaleWithConsonance}, new_scale::Scale, consonance_value::Float64)
    # ... (код функции insert_scale! для добавления лада в коллекцию)
end

function scale_consonance(scale::Scale)::Float64
    # ... (код функции scale_consonance для расчета консонанса лада)
end

function generate_scales(max_notes::Int=7)::ScaleDatabase
    scales_db = ScaleDatabase() # Инициализируем базу данных ладов
    insert_scale!(scales_db[1], [1//1], 1.0) # Добавляем унисон как первый лад

    # Цикл по количеству нот в ладу (от 2 до max_notes)
    for n in 2:max_notes
        new_scales = Vector{ScaleWithConsonance}() # Создаем массив для хранения новых ладов с n нотами

         # Перебираем все лады с n-1 нотами
        for (_, scale) in scales_db[n-1]
            # Перебираем все допустимые интервалы
            for interval in intervals
                # Перебираем все ноты в текущем ладу
                for base_note in scale
                    new_note_up = normalize_to_octave(base_note * interval) # Умножаем на интервал
                    new_note_down = normalize_to_octave(base_note / interval) # Делим на интервал

                    # Проверяем оба варианта новой ноты
                    for new_note in [new_note_up, new_note_down]
                        new_scale = sort(unique([scale; new_note])) # Создаем новый лад

                        # Проверяем, что новая нота уникальна и лад имеет n нот
                        if length(new_scale) == n
                            cons = scale_consonance(new_scale) # Расчитываем консонанс
                            if cons >= MIN_CONSONANCE # Проверяем минимальный консонанс
                                insert_scale!(new_scales, new_scale, cons) # Добавляем лад
                            end
                        end
                    end
                end
            end
        end
        scales_db[n] = new_scales #  Сохраняем новые лады в базе данных
    end

    return scales_db
end

const MAX_NOTES = 8 #  Максимальное количество нот в ладу
const MIN_CONSONANCE = 0.3 #  Минимальный консонанс

scales_db = generate_scales(MAX_NOTES)

#  Вывод результатов (код функции print_scales)
```

Алгоритм  начинается  с  унисона (одна  нота)  и  последовательно  строит  лады  с  2, 3, ... , `MAX_NOTES` нотами. На  каждом  шаге  мы  берем  все  найденные  лады  с  `n-1`  нотами  и  пробуем  добавить  к  ним  еще  одну  ноту,  используя  все  допустимые  интервалы.   Мы  умножаем  и  делим  каждую  ноту  в  исходном  ладу  на  каждый  интервал,  нормализуем  результат  к  октаве  и  проверяем,  что  полученная  нота  уникальна. Затем  вычисляем  консонанс  нового  лада  и,  если  он  превышает  `MIN_CONSONANCE`,  добавляем  лад  в  нашу  коллекцию.   **Это  полный  перебор,  который  гарантирует,  что  мы  рассмотрим  все  возможные  варианты  в  пределах  заданных  ограничений.**  Вывод  результатов  покажет  нам  найденные  лады,  отсортированные  по  консонансу. Среди  них  мы  найдем  и  знакомые  нам  мажорный  лад,  мажорное  и  минорные  трезвучия,  и  множество  других.







## Исторический экскурс: визуализация строев

Понимание исторического контекста помогает оценить новаторство предлагаемого подхода. Давайте рассмотрим эволюцию музыкальных строев через призму визуализации.

### 1. Модальность и натуральный строй (Античность):

В древности музыка строилась на  модальных ладах,  близких к натуральному строю. Числовые соотношения частот, основанные на простых дробях,  обеспечивали  чистоту созвучий. Визуализировать эти лады можно с помощью схем,  подобных  тем,  что  использовал персидский теоретик Аль-Урвами.

<iframe src="al_urmavi_visualizer.html"></iframe> <comment>Визуализатор ладов в схемах Урмави</comment>

Преимущество натурального строя —  акустическая чистота и выразительность каждого интервала. Например, малая септима может быть представлена как 7/4, 9/5 или 16/9, и эти нюансы можно использовать для создания  богатой  гармонической  палитре.





### 1. Модальность и натуральный строй (Античность):

В древности музыка строилась на  модальных ладах,  близких к натуральному строю. Числовые соотношения частот, основанные на простых дробях,  обеспечивали  чистоту созвучий. Визуализировать эти лады можно с помощью схем,  подобных  тем,  что  использовал персидский теоретик Аль-Урвами.

<iframe src="al_urmavi_visualizer.html"></iframe> <comment>Визуализатор ладов в схемах Урмави</comment>

Преимущество натурального строя —  акустическая чистота и выразительность каждого интервала. Например, малая септима может быть представлена как 7/4, 9/5 или 16/9, и эти нюансы можно использовать для создания  богатой  гармонической  палитре.

### 2. Пифагоров строй (Средневековье):

В  Средневековье  получил  распространение  пифагоров  строй,  основанный  на  кварто-квинтовом  круге.

<iframe src="pythagorean_circle_visualizer.html"></iframe> <comment>Визуализатор кварто-квинтового круга</comment>

Математически  этот  строй  можно  представить  через  степени  3/2:

```julia
pythagor = [(3//2)^i for i in -5:5]

for i in -5:5
  println("3//2^$(i) -> $((3//2)^(i))") 
end

# Нормализация к октаве
function normalize_to_octave(ratio::Rational{Int})
    ratio / (2//1)^floor(Int, log2(ratio))
end
pythagor = normalize_to_octave.(pythagor)
println(pythagor)
```

Однако  кварто-квинтовый  круг  содержит  "волчьи  квинты" — диссонирующие  интервалы,  что  ограничивает  гармонические  возможности.

### 3. Равномерная темперация (Новое Время):

Равномерная  темперация,  ставшая  стандартом  в  Новое  время,  решает  проблему  "волчьих  квинт",  но  ценой  потери  акустической  чистоты. Визуализировать  ее  можно  с  помощью  тональной  сетки (Tonnetz).

<iframe src="tonnetz_visualizer.html"></iframe> <comment>Визуализатор Tonnetz</comment>

Математически  тональную  логику  можно  выразить  через  функцию,  генерирующую  мажорные  аккорды:

```julia
major_chord(tonica) = [tonic, tonic*5//4, tonic*3//2]
tonic = 1//1
subdominant_chord = major_chord(tonic * (3//2)^-1)
tonic_chord = major_chord(tonic * (3//2)^0)
dominant_chord = major_chord(tonic * (3//2)^1)
major_scale = vcat(subdominant_chord, tonic_chord, dominant_chord)

# Или ещё проще: 
major_scale = [tonica, tonica*5//4, tonica*3//2] # Строим мажорные аккорды 

sort!(unique!(major_scale))
```

### VI. Унтертоновая полимодальность: новая философия гармонии (продолжение)

Предлагаемый подход — *унтертоновая полимодальность* — сочетает акустическую чистоту с гибкостью в использовании любых нот. Название "унтертоновая"  отражает принцип построения ладов:  каждая нота рассматривается как унтертон по отношению к общей акустической тонике, что предотвращает возникновение конкурирующих тональных центров. Идея заключается в том, что каждый голос может иметь свой лад, при этом все лады "привязаны" к общей акустической тонике. Это позволяет использовать богатую гармоническую палитру, не теряя ощущения тонального центра. Унтертоновая полимодальность открывает удивительные  возможности для композиторов. Мы можем использовать  *любую* ноту, относя её к нужному ладу. Динамика развития гармонии приобретает новую гибкость: переходы между ладами становятся более плавными и не воспринимаются как резкие  модуляции. Однако эта система требует нового мышления о гармонии, основанного на понимании акустических соотношений частот.

```julia
# ... (код для генерации унтертоновых ладов)
```

<pre><code>
# Пример сгенерированных ладов (заглушка, дополнить реальными данными)
[1, 21//20, 7//6, 6//5, 21//16, 7//5, 3//2, 14//9, 7//4, 28//15]
[1, 16//15, 6//5, 4//3, 3//2, 8//5, 16//9]
...
</code></pre>

<iframe src="polymodal_music_example.html"></iframe> <comment>Пример унтертоновой полимодальности в интерактивном приложении</comment>

### VII. Заключение: Гармония как живое пространство

Мы совершили путешествие от древних музыкальных теорий до современных алгоритмов, способных генерировать гармонические структуры. Унтертоновая полимодальность предлагает новый взгляд на гармонию — не как на жёсткий каркас, а как на живое пространство с множеством измерений. Каждый лад — это своеобразный "регион" в этом пространстве, обладающий своей уникальной звуковой палитрой, но связанный с другими регионами через общую акустическую тонику. Этот подход открывает новые возможности для музыкального творчества, позволяя композиторам исследовать неизведанные гармонические миры.

**(В приложении приводится полный код программы, математические выкладки и дополнительные иллюстрации.)**















### VI. Унтертоновая полимодальность: новая философия гармонии

Предлагаемый подход — унтертоновая полимодальность —  сочетает  акустическую  чистоту  с  гибкостью  в  использовании  любых  нот. Идея  заключается  в  том,  что  каждый  голос  может  иметь  свой  лад,  при  этом  все  лады  "привязаны"  к  общей  акустической  тонике. Это  позволяет  использовать  богатую  гармоническую  палитру,  не  теряя  ощущения  тонального  центра.

## О минорной полиладовости

### Часть 1: В поисках новой гармонии

#### Вступление

Музыка – язык  эмоций. Гармония  –  её  грамматика. На  протяжении  веков  композиторы  и  музыканты  исследовали  гармонические  возможности,  стремясь  к  новым,  неизведанным  звучаниям. От  пифагорейской  гармонии  до  сложных  политональных  экспериментов  XX  века  —  поиск  новых  гармонических  языков  всегда  был  движущей  силой  музыкальной  эволюции. Сегодня,  в  эпоху  цифровых  технологий,  у  нас  появились  новые  инструменты  для  этих  поисков.

В  этой  статье  мы  отправимся  в  путешествие  по  неизведанным  гармоническим  ландшафтам,  вооруженные  языком  программирования  Julia  и  вдохновленные  идеями  великих  умов  прошлого,  таких  как  Пифагор,  Риман  и  Эйлер. Наш  путь  будет  лежать  через  мир  обертонов  и  унтертонов,  к  новой  концепции —  *акустической  тонике*,  которая  позволит  нам  создавать  системы  ладов,  одновременно  разнообразных  и  гармонически  связанных.

#### Обертоны и унтертоны:  фундамент  гармонии

Каждый  звук,  который  мы  слышим,  —  это  не  просто  одно  колебание,  а  сложный  комплекс  частичных  колебаний,  называемых  *обертонами*. Частоты  обертонов  кратны  основной  частоте  звука  (фундаментальной). Именно  соотношения  частот  обертонов  определяют  тембр  звука,  его  уникальную  "окраску".

*Унтертоны* —  "зеркальное  отражение"  обертонов. Их  частоты  являются  делителями  основной  частоты. Хотя  унтертоны  не  всегда  физически  присутствуют  в  звуке,  они  играют  важную  роль  в  нашем  восприятии  гармонии,  создавая  "скрытую"  гармоническую  структуру.

### Часть 2:  Генерация гармонических ландшафтов

#### Алгоритм и код

Теперь, когда мы познакомились с концепцией акустической тоники, давайте разберемся, как  можно  генерировать  лады,  основанные  на  этом  принципе. Мы  будем  использовать язык программирования Julia,  который  отлично  подходит для  работы  со  звуком и  музыкой  благодаря  своей  производительности и  удобным  библиотекам.

Наш  алгоритм  будет  следующим:

1. **Выбор акустической тоники:** Мы  выбираем  ноту,  которая  будет  служить  акустической  тоникой. В  нашем  примере это  F# (1/45).
2. **Генерация обертонов:**  Мы  генерируем  ряд  обертонов  для  выбранной  тоники.
3. **Умножение на унтертоны:**  Мы умножаем  каждый  обертон на ряд  унтертонов. Это  создает  набор  возможных  интервалов  для  наших  ладов.
4. **Нормализация к октаве:**  Мы  приводим  все  полученные  интервалы  к  диапазону  одной  октавы.
5. **Фильтрация:** Мы отбираем только те интервалы, которые соответствуют определенным критериям благозвучности. В нашем случае мы ограничиваем количество простых множителей 3, 5 и 7 в числителе.
6. **Формирование ладов:** Мы комбинируем  отфильтрованные  интервалы,  формируя  лады.

Вот  реализация  этого  алгоритма  на  Julia:

```julia
using Primes

# Функция для проверки, является ли частотное отношение допустимым
function is_valid_prime_ratio(frequency_ratio::Rational)
    ispow2(denominator(frequency_ratio)) == false && return false 
    prime_factors = Primes.factor(Vector, numerator(frequency_ratio))
    
    is_valid = count(==(3), prime_factors) <= 4 &&   # не более 4-х троек
               count(==(5), prime_factors) <= 2 &&   # не более 2-х пятерок
               count(==(7), prime_factors) <= 1 &&   # не более 1-й семерки
               count( >(7), prime_factors) == 0      # нет простых больше 7
    return is_valid
end

# Функция для нормализации частотного отношения к октаве
function normalize_to_octave(frequency_ratio::Rational)
    frequency_ratio / (2//1)^floor(Int, log2(frequency_ratio))
end

# Акустическая тоника (F#)
const MAX_HARMONIC = 45

# Генерация унтертонов (унтертон ноты это звук, в обертоны которого она входит)
undertone_series = [1//i for i in 1:MAX_HARMONIC]

# Умножение каждого обертона тоники на ряд унтертонов
all_harmonics = [undertone_series * i for i in 1:MAX_HARMONIC]

# Формирование ладов
valid_scales = map(all_harmonics) do harmonic_sequence
    normalized_harmonics = sort!(unique!(map(normalize_to_octave, harmonic_sequence)))
    normalized_harmonics *= MAX_HARMONIC # Приводим все к общей тонике
    return filter(is_valid_prime_ratio, normalized_harmonics)
end

# Фильтрация ладов (больше 2 нот)
undertone_scales = filter(scale -> length(scale) > 2, valid_scales)
undertone_scales = unique!(valid_scales ./ MAX_HARMONIC)

```

#### Преобразование в ноты

Для того чтобы  музыкантам  было  удобнее  работать с  полученными  ладами,  мы  можем  преобразовать  частотные  отношения в  ноты.

```julia
# Функция для преобразования частотного отношения в количество полутонов
ratios_to_semitones(x) = Int(round(log(2^(1/12), x)))

# Названия нот
notenames = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"]
notes = Dict(i => notenames[i] for i in 1:length(notenames))

# Вывод ладов в виде нот
for scale in undertone_scales
    println("$scale") #  Рациональные отношения
    semitones = map(ratios_to_semitones, scale)
    println("$semitones")  #  Полутоны
    notes_in_scale = map(n -> notes[mod(n, 12) + 1], semitones)
    println("$notes_in_scale") # Названия нот
    println("")
end
```

В следующей части мы подробнее рассмотрим полученные лады, сравним их с традиционными и обсудим концепцию унтертоники.

### Часть 3:  Исследование гармонических ландшафтов

#### Анализ полученных ладов

Давайте  теперь  внимательно  рассмотрим  лады,  которые  мы  получили  с  помощью  нашего  кода. Вот  несколько  примеров:

*   `[1, 9//8, 6//5, 4//3, 3//2, 8//5, 9//5] -> ["C", "D", "D#", "F", "G", "G#", "A#"]` -  Натуральный минор. Знакомая  и  любимая  многими  гармоническая  структура.
*   `[1, 21//20, 7//6, 6//5, 21//16, 7//5, 3//2, 14//9, 7//4, 28//15] -> ["C", "C#", "D#", "D#", "F", "F#", "G", "G#", "A#", "B"]` -  Этот  лад  содержит  в  себе  блюзовые  ноты  и  интервалы. Обратите  внимание  на  повторяющуюся  D#.
*   `[1, 9//8, 5//4, 45//32, 3//2, 5//3, 9//5, 15//8] -> ["C", "D", "E", "F#", "G", "A", "A#", "B"]` -  Этот  лад  напоминает  лидийский,  но  с  добавлением  A#. Эта  "лишняя"  нота  создает  интересное  напряжение.
*   `[1, 10//9, 6//5, 5//4, 4//3, 3//2, 5//3, 15//8] -> ["C", "D", "D#", "E", "F", "G", "A", "B"]` -  Почти  мажор,  но  с  D#. Эта  нота  вносит  минорную  окраску  в  мажорную  структуру.

#### Унтертоника: ключ к пониманию

Как  мы  видим,  сгенерированные  лады  могут  быть  как  близкими  к  традиционным,  так  и  совершенно  необычными. Ключ  к  пониманию  их  структуры  —  это  *унтертоника*. Унтертоника –  это  обертон  акустической  тоники (в  нашем  случае – F#, 1/45),  от  которого  начинается  построение  лада. Именно  унтертоника  определяет  характерные  интервалы  и  звучание  лада. Мы идем по всем обертонам тоники (...., 5/1, 6/1, 7/1, ....15/1 и так далее), и от каждой из них строим унтертоновую последовательность (с последующей фильтрацией по принадлежности к основной тонике!). Это и отвечает за разнообразие ладов при едином гармоническом центре.

#### Минорная/унтертоновая полиладовость

Теперь мы подошли к самому интересному –  *минорная/унтертоновая полиладовость*. Эта концепция  означает,  что  мы  можем  использовать  *несколько*  ладов  с  общей  акустической  тоникой  *одновременно*.

Почему  это  работает?

*   **Общая  акустическая  тоника:**  Все  лады  "привязаны"  к  одной  и  той  же  акустической  тонике (F#),  что  обеспечивает  гармоническое  единство.
*   **Минорная  окраска:**  Унтертоновая  основа  ладов  придает  им  "минорную"  окраску,  что  снижает  риск  конфликта  тоник  и  делает  их  звучание  более  сочетаемым.

#### Гармонические  возможности:

*   **Вертикальная  полиладовость:**  Разные  инструменты  или  голоса  могут  играть  в  разных  ладах  одновременно,  создавая  богатую  и  сложную  гармоническую  текстуру. *Важно:  разделение  ладов  по  инструментам  помогает  избежать  гармонической  "каши".*
*   **Горизонтальная  полиладовость:**  Музыка  может  плавно  или  резко  переходить  от  одного  лада  к  другому,  создавая  драматургическое  развитие.

В  следующей части мы рассмотрим примеры музыкального применения унтертоновой полиладовости, поговорим об импровизации и затронем вопросы музыкальной теории.

### Часть 4:  Музыка в новых измерениях

#### Музыкальные примеры и перспективы

Теперь, когда мы  понимаем  теоретические  основы  унтертоновой  полиладовости,  давайте  поговорим о том,  как  это  можно  применять  на  практике. Представьте  себе  музыкальное  произведение,  где  каждый  инструмент  играет  в  своем  собственном  ладу,  но  все  лады  объединены  общей  акустической  тоникой (F#). 

* **Пример 1:  Совмещение традиционных ладов в единой гармонии.**  Представим струнный квартет. Первая  скрипка  играет  мелодию  в  натуральном  миноре  (`"C", "D", "D#", "F", "G", "G#", "A#"`),  альт  –  в  ладу,  напоминающем  блюзовый (`"C", "C#", "D#", "D#", "F", "F#", "G", "G#", "A#", "B"`),  виолончель  поддерживает  гармоническую  основу,  играя  арпеджио  на  обертонах  F#,  а  контрабас  держит  педаль  на  самой  F#.

* **Пример 2: Прямое обыгрывание обертонов тоники.**  Если брать простые лады, такие как 5/5, 5/4, 5/3 (C, E, A) или 9/9, 9/8, 9/6, 9/5 (C, D, G, A#) будет более очевидно, что все ноты одного лада как бы "подвешены" на соответствующем обертоне акустической тоники.

* **Пример 3: Совмещение традиционной гармонии и полиладовой унтертоновости.** Ноты баса могут быть  в мажорной пентатонике, лидийском ладе или даже мажоре, а вот верхние инструменты в унтертоновых ладах будут прекрасно дополнять их, разрешая использовать практически любую из хроматических нот

* **Пример 4.** Обыгрывание тонких различий натурального строя. Представим, что у нас есть лад от унтертоники 16/1: 16/15, 16/12, 16/9, 16/5 (C F A# G#) и лад от 9/1: 9/9, 9/8, 9/6, 9/5 (C, D, G, A#). Видно, что нота A# совпадает в разных ладах, но в натуральном строе между ними есть тонкое различие в 22 цента. Мало и едва уловимо слухом, но достаточно заметно, если специально играть на контрасте между разными инструментами.

  ```julia
  julia> cents(x) = Int(round( log(2^(1/1200), x)))
  cents (generic function with 1 method)
  
  julia> cents(16/9)
  996
  
  julia> cents(9/5)
  1018
  
  julia> cents(9/5) - cents(16/9)
  22
  ```

  

* **Пример 3: Электронная музыка.**  Разные  синтезаторы  могут  играть  мелодии  и  гармонии  в  разных  ладах,  создавая  сложные  и  многослойные  звуковые  текстуры. Эффекты  реверберации  и  задержки  могут  еще  больше  "размыть"  границы  между  ладами,  создавая  ощущение  "гармонического  облака".

### Импровизация:  свобода в рамках гармонии

Унтертоновая  полиладовость  открывает  новые  горизонты  для  импровизации. Музыканты  могут  свободно  перемещаться  между  разными  ладами,  не  боясь  потерять  тональный  центр. Общая  акустическая  тоника  служит  своего  рода  "маяком",  который  всегда  поможет  вернуться  "домой".

### Музыкальная теория: переосмысление основ)

Концепция  акустической  тоники  бросает  вызов  традиционным  представлениям  о  гармонии. Она  позволяет  нам  переосмыслить  такие  фундаментальные  понятия,  как  тоника,  лад,  гармоническая  функция. Возможно, в будущем  нам  потребуются  новые  системы  музыкальной  нотации,  которые  смогут  адекватно  отобразить  сложные  взаимосвязи  между  звуками  в  унтертоновой  полиладовости.

###  

##  Гармония и аранжировка в унтертоновой полимодальности: практические правила

Унтертоновая полимодальность открывает перед композиторами и аранжировщиками поистине безграничные возможности. Она позволяет создавать сложные и многослойные музыкальные текстуры, сохраняя при этом ощущение тонального центра и гармонической целостности. Давайте погрузимся в мир практических правил, которые помогут вам эффективно использовать этот новаторский подход.

**1. Октавное расположение нот: ключ к благозвучию**

**Цель:** Достичь максимального консонанса и минимизировать диссонансы в аккордах, создавая ощущение гармонической чистоты.

**Принцип:**  Располагайте ноты в аккорде таким образом, чтобы отношения между *соседними* по высоте нотами были максимально простыми. **Стремитесь  к  упрощению  общей  тоники  аккорда  (то  есть,  к  увеличению  ее  знаменателя). Также  важно,  чтобы  общая  тоника  была  по  возможности  близка  к  звучащим  нотам.** Помните о близости к естественным обертонам – это придаст звучанию естественность и глубину.

**Практические советы:**

*   **Избегайте сложных соотношений между соседними нотами.**  Например,  интервал 9/8 между соседними нотами в аккорде может звучать напряженно. Попробуйте  перенести  одну  из  нот  на  октаву  вверх  или  вниз,  чтобы  получить  более  простое  соотношение,  например,  9/4  или  9/2.
*   **Стремитесь  к  упрощению  общей  тоники  аккорда  (то  есть,  к  увеличению  ее  знаменателя). Также  важно,  чтобы  общая  тоника  была  по  возможности  близка  к  звучащим  нотам.**  Например,  аккорд  с  общей  тоникой  1/4  будет  звучать  более  консонантно,  чем  аккорд  с  общей  тоникой  1/8.
*   **Прислушивайтесь к естественным обертонам.**  Интервалы,  близкие  к  естественным  обертонам,  воспринимаются  как  более  благозвучные. Например,  интервал  5/4  (большая  терция)  звучит  более  естественно,  чем  интервал  81/64  (пифагорейская  большая  терция).

**Пример:**

Рассмотрим аккорд, состоящий из нот с отношениями 5/4, 3/2 и 9/8.

*   **Неоптимальное расположение:** 5/4 (E4), 9/8 (D5), 3/2 (G5) - общая тоника мала, между D5 и G5 сложное соотношение. Звучание может быть резким.
*   **Оптимальное расположение:** 5/4 (E4), 3/2 (G4), 9/2 (D6) -  общая тоника больше, все соотношения простые. Звучание  более  благородное  и  консонантное.

Мы перенесли ноту D на две октавы вверх, упростив соотношение с G4 и увеличив общий знаменатель.

**2. Разделение нот между инструментами: прозрачность фактуры**

**Цель:**  Избежать  "гармонической  грязи",  создать  ясную,  прозрачную  и  богатую  фактуру,  где  каждый  инструмент  вносит  свой  уникальный  вклад  в  общее  звучание.

**Принцип:**  Распределяйте  ноты  по  инструментам,  группируя  их  в  минорные  лады,  объединенные  общей  унтертоникой. Ноты,  имеющие  общие  множители  в  числителях  и  знаменателях  (относительно  унтертоник),  размещайте  в  *разных*  ладах  и,  соответственно,  назначайте  разным  инструментам.

**Практические советы:**

*   **Мыслите ладами, а не отдельными нотами.**  Представьте,  что  каждый  инструмент  играет  в  своем  собственном  ладу,  но  все  лады  связаны  общей  акустической  тоникой.
*   **Используйте  разные  унтертоники  для  разных  ладов.**  Это  создаст  богатство  гармонических  красок  и  позволит  избежать  монотонности.
*   **Следите за общими множителями.**   Ноты с общими множителями в разных ладах лучше не назначать на один инструмент во избежание диссонанса.
* **Распределяйте лады по регистрам инструментов.** Для большей гармоничности старайтесь распределить ноты по октавам, по регистрам инструментов.

**Пример:**

Для акустической тоники F# (1/45) можно построить, например, такие лады:

*   **Лад 1 (унтертоника 5/1):** 9/1 (C#), 45/4 (E), 15/1 (A)  (все ноты – обертоны F# 1/45, но сгруппированы вокруг унтертоники 5/1)
*   **Лад 2 (унтертоника 6/1):** 15/2 (A#), 27/2 (C#), 45/2 (E), 45/1 (F#) (все ноты – обертоны F# 1/45, сгруппированы вокруг 6/1)
*   **Лад 3 (унтертоника 9/1):** 5/1 (F#), 45/8 (G#), 15/2 (A#), 9/1 (C#) (все ноты – обертоны F# 1/45, сгруппированы вокруг 9/1)

**Назначьте  каждый  из  этих  ладов  отдельному  инструменту.** Так, нота 9/1 (C#) встречается и в первом, и в третьем ладу. Но на одном инструменте она звучать не будет.

**3. Сознательное использование обертонов и микрохроматики: выразительные средства**

**Цель:**  Обогатить  музыкальную  палитру,  создать  тонкие  нюансы  звучания,  использовать  музыкальное  напряжение  и  разрешение  для  усиления  эмоционального  воздействия.

**Принцип:**  В  унтертоновой  полимодальности  вы  можете  *осознанно*  управлять  совпадениями  и  различиями  между  обертонами  разных  нот,  создавая  уникальные  звуковые  эффекты.

**Практические советы:**

*   **Подчеркивайте совпадение обертонов:**  Если  у  разных  инструментов  в  определенный  момент  совпадают  обертоны,  это  создает  ощущение  особого  консонанса  и  гармонической  связи. Используйте  этот  эффект  для  создания  ощущения  устойчивости  и  разрешения.
*   **Используйте  микрохроматические  различия:**  Между  близкими  звуками,  представляющими  разные  отношения  (например,  16/9  и  9/5),  существует  едва  уловимая  разница  (22  цента). Исполнение  этих  звуков  одновременно  создаст  эффект  "биения",  добавляя  звучанию  вибрато  и  особую  окраску. Этот  прием  можно  использовать  для  создания  напряжения  или  достижения  особых  тембровых  эффектов.
*   **Экспериментируйте!**  Не  бойтесь  пробовать  новые  сочетания  звуков  и  исследовать  неизведанные  гармонические  территории. Унтертоновая  полимодальность  открывает  для  этого  безграничные  возможности.

**Примеры:**

*   Один инструмент играет ноту G (отношение к тонике 3/2), а другой в это же время играет ноту D (отношение к тонике 9/8, скорректированное по октаве до 9/2). Третий обертон ноты G совпадет с основным тоном ноты D, создавая ощущение консонанса.
*   Два инструмента играют близкие звуки с отношениями 16/9 и 9/5, создавая эффект "биения", который можно использовать, например, для создания ощущения "мерцания" или "дрожания".

**4. Импровизация: свобода в гармоническом пространстве**

Унтертоновая полиладовость - настоящий рай для импровизатора! Общая акустическая тоника служит своеобразным "компасом", позволяя музыкантам свободно перемещаться между ладами, не теряя ощущения гармонической целостности.
Можно заходить на неизведанные территории, зная, что всегда есть "путь домой".
При этом, свобода не превращается в хаос - ведь все звуки, так или иначе, соотносятся с общей тоникой.

**5. Драматургия: управляйте гармоническим напряжением**

В унтертоновой полимодальности можно управлять гармоническим напряжением, переходя от консонанса к диссонансу и обратно, от гармонической простоты к сложным, насыщенным звучаниям.
Всё это достигается простым варьированием ладов.
Например, можно начать произведение в одном ладу, а затем постепенно подключать инструменты в других ладах, увеличивая гармоническую сложность.
Или же можно использовать контраст между ладами для создания драматического эффекта.
Помните, что тоника у вас общая - а значит, сохраняется "каркас", основа гармонии.

**Заключение**

Унтертоновая полимодальность – это не просто набор правил, а, скорее,  целостная система мышления,  новый  взгляд  на  гармонию. Она  побуждает  композиторов  и  аранжировщиков  мыслить  не  отдельными  нотами  или  аккордами,  а  целыми  гармоническими  пространствами,  сотканными  из  взаимосвязанных  ладов. Освоив  принципы  унтертоновой  полимодальности,  вы  сможете  создавать  музыку  невиданной  ранее  глубины  и  красоты,  открывая  новые  горизонты  музыкальной  выразительности.





---

## III. Исторический экскурс и темперации: от гармонии сфер к унтертоновой полимодальности

Музыкальная гармония, подобно Вселенной, не стоит на месте. Она эволюционирует, расширяя свои границы, от простых созвучий древности до сложных гармонических структур современности. В этом разделе мы проследим этот путь, увидим, как **унтертоновая полимодальность** вписывается в этот процесс, и почему она является **логичным шагом** в развитии музыкального мышления.

### 1. Античность и Средневековье: рождение музыкальной математики

#### Открытие Пифагора: число как основа гармонии

Путешествие в историю гармонии начинается с **Пифагора** (VI век до н.э.), который, согласно легенде, обнаружил связь между высотой звука и длиной струны. Это открытие стало революционным: **музыка впервые обрела числовое выражение**. Простые отношения длин струн – 2:1 (октава), 3:2 (квинта), 4:3 (кварта) – легли в основу **пифагорова строя** и стали фундаментом европейской музыкальной теории.

**Пифагоров строй:** не только чистые квинты, но и **шаг к темперации**.
Важно понимать, что пифагоров строй – это не просто набор чистых квинт. **Это – система, основанная на степени числа 3/2**, что делает его **предтечей равномерной темперации**. Ведь квинта (3/2) – это приблизительно 7 полутонов (701.96 центов вместо ровно 700). **Именно поэтому пифагоров строй позволял с неплохой точностью передавать не только квинты, но и другие интервалы.**

```
# Пример расчета интервалов в пифагоровом строе в центах:
function cents(ratio::Rational{Int})
    1200 * log2(ratio)
end

println("Квинта (3/2) в центах: ", round(cents(3//2)))
println("Большая секунда (9/8) в центах: ", round(cents(9//8)))
```

**Однако у этой системы были и границы применимости.** Чем дальше мы движемся по кварто-квинтовому кругу (то есть, чем выше степень 3/2), тем сложнее получаются дроби и тем заметнее накапливается погрешность. После 12 шагов круг не замыкается, и возникает "волчья квинта" – диссонирующий интервал, непригодный для музыки. **Это и стало отправной точкой для поиска новых, более совершенных строев.**

**<вставить иллюстрацию с расчетом погрешностей в пифагоровом строе>**
*Комментарий:  здесь  будет  иллюстрация,  наглядно  демонстрирующая  накопление  погрешности  в  пифагоровом  строе  при  движении  по  кварто-квинтовому  кругу.*

#### Не только Пифагор: Аристоксен, Птолемей и шрути

Важно помнить, что Пифагор – не единственный герой античной музыкальной теории. **Аристоксен** (IV век до н.э.) в "Элементах гармоники" подчеркивал важность **слухового восприятия**, а не только математических расчетов. **Клавдий Птолемей** (II век н.э.) в "Гармонике" предложил строй, учитывающий не только квинты, но и **терции**, важные для благозвучия.

Параллельно, в **Древней Индии**, развивалась система **шрути**, делившая октаву на 22 части. Это показывает, что поиск **математических основ гармонии** был общечеловеческим явлением.

#### Аль-Урмави: визуализация гармонии

**Сафи ад-Дин аль-Урмави** (XIII век), персидский теоретик, предложил систему из 17 ступеней в октаве. Но что еще важнее – он **визуализировал лады** с помощью диаграмм, напоминающих современные **arc diagrams**. Это был прорыв: **структура лада стала наглядной**, соотношения между ступенями – очевидными.

**<iframe src="al_urmavi_visualizer.html" width="800" height="600">Ваш браузер не поддерживает iframe</iframe>**
*Комментарий: здесь  интерактивный  визуализатор  ладов  Аль-Урмави,  позволяющий  исследовать  соотношения  между  ступенями  и  сравнивать  разные  лады.*

### 2. Новое время: от тональной логики к темперации

#### Мажоро-минор и формула тональной гармонии

С развитием многоголосия в эпоху Возрождения и Барокко недостатки пифагорова строя стали слишком заметны. Композиторы искали строй, который позволил бы **свободно переходить из одной тональности в другую**, не сталкиваясь с фальшивыми интервалами. На  смену  модальности  Средневековья  приходит  **тональная  логика**,  основанная  на  системе  **мажоро-минорных  ладов**. В  ее  основе  -  тяготение  неустойчивых  ступеней  к  устойчивым,  формирующее  ощущение  **тонального  центра  -  тоники**.

Мажорные  аккорды,  ставшие  фундаментом  новой  гармонии,  можно  описать  простой  формулой:

**\[тоника,  тоника \* 5/4,  тоника \* 3/2]**

Эта  формула  -  не  просто  набор  интервалов,  а  **отражение  естественных  обертоновых  соотношений**,  придающих  мажорному  трезвучию  его  характерную  "светлую"  и  "устойчивую"  окраску.

#### Риман и его Tonnetz: наглядная гармония

В  XIX  веке  **Гуго  Риман**  совершил  новый  прорыв,  создав  теорию  **гармонических  функций**. Он  не  просто  описал  отношения  между  аккордами,  но  и  визуализировал  их  с  помощью  **Tonnetz**  (тональной  решетки)  -  элегантной  диаграммы,  где  каждый  узел  представляет  собой  трезвучие,  а  связи  между  узлами  отражают  терцовые  и  квинтовые  соотношения.

**<iframe src="tonnetz_visualizer.html" width="800" height="600">Ваш браузер не поддерживает iframe</iframe>**
*Комментарий:  здесь  интерактивный  визуализатор  Tonnetz,  позволяющий  исследовать  тональные  отношения  и  строить  аккордовые  последовательности.*

#### Темперация: трудный поиск компромисса

Итак, к XVII-XVIII векам у композиторов был мощный инструмент – тональная система. Но была и проблема – "волчья квинта" и нечистые терции пифагорова строя. Нужен был компромисс, и имя ему – **темперация**.

Суть темперации – в **небольшом искажении чистых интервалов ради возможности свободно модулировать и улучшить звучание терций**. Появилось множество систем темперации: **среднетоновая** (где квинты немного уменьшались для получения чистых терций), **хорошо темперированный клавир** (различные варианты, предложенные Веркмейстером, Кирнбергером и другими).

#### Равномерная темперация (12-EDO): победа компромисса

В  итоге  победила  **равномерная  темперация  (12-EDO)**,  где  октава  делится  на  12  равных  полутонов. В  этом  строе  все  интервалы  немного  "не  попадают"  в  свои  чистые  значения,  но зато  **исчезает  "волчья  квинта"  и  появляется  возможность  играть  в  любой  тональности**.

**12-EDO  -  это  компромисс**,  и  он  не  идеален  с  точки  зрения  чистоты  интервалов. Но  именно  он  стал  стандартом  западной  музыки,  позволив  ей  развиваться  в  том  направлении,  в  котором  она  развивалась  последние  три  столетия.

**<вставить график сравнения темпераций>**
*Комментарий:  здесь  будет  твой  график  со  сравнением  различных  темпераций  (пифагоров  строй,  среднетоновая,  равномерная,  возможно  какие-то  варианты  хорошей  темперации)  и  кратким  принципом  расчета. Важно  показать,  насколько  каждая  темперация  отклоняется  от  чистых  интервалов.*

#### Бах и "Хорошо темперированный клавир": торжество новой гармонии

**Иоганн  Себастьян  Бах**  своим  циклом  **"Хорошо  темперированный  клавир"  (ХТК)**  не  просто  продемонстрировал  возможности  нового  строя  (скорее  всего,  не  равномерного,  а  одного  из  вариантов  хорошей  темперации). Он  открыл  **новую  эру  в  музыке**,  показав,  как  богатство  тональных  красок  и  возможностей  модуляций  способно  обогатить  музыкальный  язык.

### 3. XX и XXI века: отказ от тональности и возвращение к чистым интервалам

#### Атональность и микротональность: в поисках новой выразительности

XX  век  стал  временем  радикальных  перемен  в  музыке. **Арнольд  Шенберг**  и  его  последователи  отказались  от  тональности,  создав  **атональную  музыку**,  а  затем  и  **додекафонию**  -  технику  композиции,  основанную  на  12-тоновых  сериях.

С  нашей  точки  зрения,  **атональность  -  это  потеря  ориентиров**,  отсутствие  иерархии  в  музыкальном  пространстве. Если  тональность  подобна  Солнечной  системе  с  Солнцем-тоникой  в  центре,  то  атональность  -  это  открытый  космос  без  единой  точки  притяжения.

Параллельно  развивалась  **микротональная  музыка**,  исследующая  интервалы  меньше  полутона. **Гарри  Парч**  создал  свой  43-тоновый  строй  на  основе  **чистых  интервалов**  и  изобрел  инструменты  для  исполнения  своей  музыки. **Алоис  Хаба**  экспериментировал  с  четвертитоновой  и  шеститоновой  системами. **Важно  понимать,  что  попытки  Хабы  использовать  равномерно-темперированные  микротоновые  системы  (24-EDO,  36-EDO  и  т.д.)  не  приближают  нас  к  чистым  интервалам,  а  лишь  умножают  количество  ступеней  в  уже  темперированной  системе.**

#### Спектральная музыка:  вслушиваясь  в  тембр

**Спектральная  музыка**  (Жерар  Гризе,  Тристан  Мюрай)  пошла  другим  путем. Она  обратилась  к  **тембровой  структуре  звука**,  используя  спектральный  анализ  для  создания  композиций,  основанных  на  обертоновых  соотношениях. В  России  **Евгений  Мурзин**  изобрёл  синтезатор  **АНС**,  позволяющий  рисовать  звук  и  его  спектр,  открывая  уникальные  возможности  для  спектральной  композиции.

#### Бела Барток и Майлз Дэвис: полимодальность как предчувствие

**Бела  Барток**,  соединяя  влияние  народной  музыки  с  новаторскими  идеями,  активно  использовал  **полимодальность**  -  одновременное  сочетание  разных  ладов,  расширяя  тональную  систему  изнутри. В  "Чудесном  мандарине"  он  использует  параллельно  лидийский  и  фригийский  лады,  создавая  особый  колорит  и  гармоническое  напряжение  -  чем  не  прототип  унтертоновой  полимодальности?

**Майлз  Дэвис**  в  **модальном  джазе**  также  отказался  от  жесткой  аккордовой  последовательности,  предпочитая  свободу  модальных  ладов. Это  создает  ощущение  пространства  и  открытости,  роднящее  модальный  джаз  с  нашим  подходом.

### 4. Унтертоновая полимодальность: гармония будущего

Унтертоновая  полимодальность  -  не  отрицание  прошлого,  а  **синтез  лучших  достижений  музыкальной  мысли**. Она  впитывает  идеи  **чистых  интервалов**  Пифагора  и  Парча,  **визуализации  гармонии**  Аль-Урмави  и  Римана,  **полимодальность**  Бартока  и  Дэвиса,  **спектральный  подход**  французской  школы.

Но  главное  -  она  предлагает  **новый  способ  организации  гармонического  пространства**,  основанный  на  **унтертонах  и  общей  акустической  тонике**. Это  позволяет  сочетать  богатство  гармонических  красок  с  ощущением  тонального  центра,  открывая  новые  возможности  для  композиторов  и  импровизаторов. Унтертоновая  полимодальность  -  это  **гармония  будущего,  которая  уже  доступна  нам  сегодня**.



### VII. Заключение: Гармония как живое пространство

Мы  совершили  путешествие  от  древних  музыкальных  теорий  до  современных  алгоритмов,  способных  генерировать  гармонические  структуры.   Унтертоновая  полимодальность  предлагает  новый  взгляд  на  гармонию  — не  как  на  жесткий  каркас,  а  как  на  живое  пространство  с  множеством  измерений.   Каждый  лад —  это  своеобразный  "регион"  в  этом  пространстве,  обладающий  своей  уникальной  звуковой  палитрой,  но  связанный  с  другими  регионами  через  общую  акустическую  тонику.   Этот  подход  открывает  новые  возможности  для  музыкального  творчества,  позволяя  композиторам  исследовать  неизведанные  гармонические  миры.

**(В  приложении  приводится  полный  код  программы,  математические  выкладки  и  дополнительные  иллюстрации.)**











