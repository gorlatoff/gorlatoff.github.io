<article>
  <title>Magnum Opus: Новая система музыкальной гармонии</title>

  <section>
    <h1>I. Введение</h1>
    <p>Предлагаемое решение: Новая система, основанная на физике звука (обертоны, рациональные соотношения частот) и использовании компьютерных интерфейсов. Интеграция принципов Just Intonation с любым строем. Гибкость в использовании любых нот в контексте тональности.</p>
    <p>Преимущества: Расширение гармонических возможностей, точное отражение акустической природы музыки, новые инструменты для композиторов.</p>

    <subsection>
      <h2>Проблематика существующих строев:</h2>
      <ul>
        <li>Натуральный строй (Урмави, Античность): Акустическая чистота, но невозможность транспонирования, негибкость.</li>
        <li>Кварто-квинтовый строй (Пифагор, Средневековье): Возможность транспозиции, но волчьи квинты.</li>
        <li>Равномерно-темперированный строй (Тоннетц, Новое время): Удобство модуляции, но потеря нюансов (7/4, 9/5, 16/9 — малая септима), меньшая акустическая чистота (биения), выровненность интервалов.</li>
      </ul>
    </subsection>

    <p>Связанные работы: Евгений Мурзин, Сафиаддин Аль Урмави, Риман, Эйлер, исследователи Just Intonation.</p>
  </section>


  <section>
    <h1>II. Физика звука и гармонии</h1>

    <subsection>
      <h2>Обертоны и гармонический ряд:</h2>
      <p>Извлеките из гитарной струны звук и попробуйте приглушить её пальцем в том месте, где струна делится ровно наполовину (12 лад). ...  Если повторить это с делением струны на три (7 и 19 лад), четыре и пять частей, вы услышите, что каждый следующий обертон звучит выше и тише, чем предыдущий.  Подобный трюк можно проделать с любым струнным инструментом, с обертоновой флейтой или даже [с собственным голосом](https://www.youtube.com/watch?v=vC9Qh709gas&t=145s). </p>
      <p>Музыкальный звук — это сумма стоячих волн (или гармоник), частоты которых кратны частоте основного тона.</p>
      <image alt="иллюстрация с гармониками как отдельными волнами, укладывающимися в основной тон" src="harmonics_waveform.png"></image>
      <iframe src="interactive_oscilloscope.html"></iframe> <comment>Интерактивный пример с осциллоскопом, на котором можно включить разные обертоны с разными формами волны, укладывающимися в основной тон</comment>

    </subsection>

    <subsection>
      <h2>Рациональные соотношения частот:</h2>
      <p>Музыкальные интервалы (даже темперированные!) это соотношения рациональных чисел. ...  мы можем видеть, что при разных интервалах у нот совпадают частоты разных гармоник.</p>
      <example>
        <p>Нота 1, 100 гц. Обертоны: 100, 200, **300**, 400, 500, **600**, 700, 800, **900**, 1000, 1100, **1200**</p>
        <p>Нота 2, 150 гц (100 гц * 3/2). Обертоны: 150, **300**, 450, **600**, 750, **900**, 1050, **1200**, 1350</p>
      </example>
      <p> ... у разных интервалов (и даже групп нот!) можно математически вычислить общую тонику. А их общая нота/тоника это просто наименьшее общее кратное, для дробей оно считается чуть сложнее, чем для простых чисел. </p>
    </subsection>


    <subsection>
      <h2>Консонантность/диссонанс:</h2>
      <p>...Мы можем посчитать процент общих обертонов и оценить консонантность/благозвучность интервала (другие методы - Harmonic Enthropy, Euler Gradus Function).</p>
        <p>Если частоты двух нот относятся друг к другу как целые дроби вида m/n, тогда у этих нот будут совпадать определенные гармоники. ...  что позволяет найти процент совпадающих гармоник 1/m + 1/n, достаточно хорошо кореллирующий с благозвучностью интервала.</p>
        <image alt="пример с совпадающими гармониками разных нот" src="overlapping_harmonics.png"></image>
        <iframe src="harmonics_visualizer.html"></iframe> <comment>Визуализатор гармоник на спектрограмме. Все гармоники кликабельны и звучат, а программа показывает общую тонику для двух звуков</comment>

        <p>Также у любых двух нот, которые представлены в виде рациональных отношений чисел, можно найти акустическую тонику, которая рассчитывается как наименьший общий делитель. Для дробей это НОК(m,n)/НОД(m,n). А понятия благозвучности и тоники открывают нам путь к музыкальным ладам.</p>

        <p>Прежде чем продолжить, хочу рассказать о более развитой методике определения консонантности под названием [гармоническая энтропия](https://en.xen.wiki/w/Harmonic_entropy). ... </p> <comment>тут я сам не понял как она работает и остановился</comment>
        <iframe src="harmonic_entropy_visualizer.html"></iframe> <comment>интерактивный пример графика Harmonic Entropy</comment>
       <image alt="очень похожий график с эмпирическим анализом благозвучности интервалов" src="consonance_empirical.png"></image> <comment>сначала математически ищем все возможные простые интервалы, которые можно слышать, потом оцениваем благозвучность</comment>
    </subsection>
  </section>


  <section>
    <h1>III. Новая система музыкальной записи (через компьютерные интерфейсы, в основном)</h1>
    <p> Можем показывать это как в спектрограмме (ноты это горизонтальные линии), где высота звука отображается по вертикали, продолжительность по горизонтали, а громкость это яркость. Никаких условностей для длительности или тональности, максимальная приближенность к физике.  Для помощи композитору можем отображать тонику, при нажатии на ноту отображать отношения других нот к ней и так далее. </p>
  </section>


  <section>
    <h1>IV. Минорная унтертоновая полиладовость</h1>

    <subsection>
      <h2>Концепция:</h2>
      <p>... мелодические линии для каждого инструмента независимы друг от друга, поэтому каждый голос может иметь свой, отдельный музыкальный лад, даже если он не укладывается в классическую минорную или мажорную тональность. ...  необходимо сохранять ощущение тоники ..., поэтому лады должны быть минорными и не создавать тональных центров, альтернативных главной гармонии.  Поэтому мы строим список возможных ладов, которые будут укладываться в единую тонику. ...  создается парадоксальная ситуация, когда все звуки всех ладов принадлежат одному тональному центру, но звуки каждого лада имеют свою "унтертонику" ...  Для акустических рассчетов использую Just Intonation, но та же логика может работать и в равномерной темперации.</p>
    </subsection>

    <subsection>
      <h2>Список ладов (сгенерированный программой на Julia):</h2>
<pre><code>
11-element Vector{Vector{Rational{Int64}}}: 
  [1, 21//20, 7//6, 6//5, 21//16, 7//5, 3//2, 14//9, 7//4, 28//15]
   [1, 16//15, 6//5, 4//3, 3//2, 8//5, 16//9]
   [1, 16//15, 4//3, 64//45, 8//5, 16//9]
   [1, 35//32, 7//6, 5//4, 7//5, 35//24, 14//9, 5//3, 7//4, 35//18] 
  [1, 10//9, 6//5, 5//4, 4//3, 3//2, 5//3, 15//8]
   [1, 10//9, 5//4, 4//3, 8//5, 5//3, 16//9] 
  [1, 10//9, 5//4, 5//3]
   [1, 9//8, 6//5, 4//3, 3//2, 8//5, 9//5] 
  [1, 9//8, 6//5, 27//20, 3//2, 27//16, 9//5]
   [1, 9//8, 5//4, 45//32, 3//2, 5//3, 9//5, 15//8] 
  [1, 7//6, 56//45, 4//3, 7//5, 14//9, 8//5, 7//4, 28//15]
</code></pre>
      <p>... Каждое соотношение соответствует интервалам 12-ступенного строя, например 3/2 ≈ 7 полутонов.</p>

      <p>...  Пробую этот подход, вижу и недостатки и достоинства. Можно в одной композиции использовать любую ноту, главное отнести её в нужный лад. Можно использовать кучу разных ладов, для низких звуков даже мажор. Все лады звучат вместе хорошо, даже когда используешь много и разных, а тоника слышна.</p>
      <p>... высчитанные мною лады не совпадают с большинством популярных ладов. Вроде и оригинальность, и проблемы с повторением созданного. </p>
    </subsection>


    <subsection>
      <h2>Программная реализация:</h2>
      <p>... я планирую написать прототип программы, которая будет автоматически предлагать тебе возможные с данной тоникой лады и показывать всё это в музыкальной записи, показывающей высоты/продолжительности/громкости, которые зависят от вертикали/горизонтали/яркости и показывает рациональные отношения для каждой ноты. </p>
    </subsection>

  </section>


  <section>
    <h1>V. Исторический контекст и сравнение строев</h1>

    <subsection>
<h2>Модальность и натуральный строй (Античность):</h2>
<p>... Визуализатор ладов в схемах, похожих на схемы персидского теоретика Al Urmavi.</p>
<iframe src="al_urmavi_visualizer.html"></iframe>
<p>Пишем о преимуществах и недостатках натурального строя, а это не только чистота, но и выразительность/точность. Например, малая септима это одновременно 7/4, 9/5 и 16/9, и эту разницу можно обыгрывать, если найдем способ использовать их одновременно (а мы нашли -  минорная полиладовость).</p>
</subsection>


<subsection>
<h2>Пифагоров строй (Средневековье):</h2>
<p>... Визуализатор кварто-квинтового круга и теоремы Пифагора. Показывает, почему круг квинт перестает работать после нескольких шагов.</p>
<iframe src="pythagorean_circle_visualizer.html"></iframe>
</subsection>

<subsection>
      <h2>Сравнение Пифагорова и натурального строя:</h2>
      <p>Функция, которая приводит дроби в диапазон от 1 до 2 домножением на нужную степень двойки:</p>
<pre><code>
flatted_value(i) = i / (2//1)^floor(Int, log2(i))
flatted(scale) = [flatted_value(i) for i in scale]
</code></pre>

<p>Пифагоров строй:</p>
<pre><code>
pythagor = [(3//2)^i for i in -5:5]

for i in -5:5
  println("3//2^$(i) -> $((3//2)^(i))") 
end

julia> pythagor = flatted(pythagor)
11-element Vector{Rational{Int64}}:
 256//243
 128//81
  32//27
  16//9
   4//3
    1
   3//2
   9//8
  27//16
  81//64
 243//128
</code></pre>

<p>Мы видим, что уже с 4 степени двойки начинаются огромные дроби, со сложными соотношениями, которые невозможно распознать на слух.</p>

<p>Натуральный строй:</p>
<pre><code>
  16/15
  8//5
  6//5
  16//9
  4//3
   1
  3//2
  9//8
  5//3
  5//4
 15//8
</code></pre>


<p>... Соответственно у нас открываются офигенные возможности. ... Фактически это система организации, которая требует знания тоники, но не ограничивается только диатоникой, а включает в контекст тональности любую возможную ноту
C - 1/1
C# - 16/15
D - 10/9, 9/8
E - 5/4
.....
Есть и недостатки, одна и та же темперированная нота может относиться к разным соотношениям, а такое мышление одновременно и точнее, и отражает гармоническую неоднозначность живой музыки. Именно поэтому я предлагаю не переход к Just Intonation, а только мышление в нем, строй может оставаться темперированным или любым другим. Но гармония работает именно на рациональных соотношениях чисел. С другой стороны, это и открывает путь к новым путям выражения, у меня есть эксперименты, в которых мелодия использует дидимову комму (хотя и 10/9 и 9/8 это нота D, но она может отличаться в высоте и контексте).</p>
    </subsection>


    <subsection>
      <h2>Равномерная темперация (Новое Время):</h2>
      <p>... Визуализатор Tonnetz, в JI и темперированном строе.</p>
      <iframe src="tonnetz_visualizer.html"></iframe>
    </subsection>

</section>


  <section>
    <h1>VI.  Эксперименты и примеры</h1>
    <p>Дидимова комма: Примеры использования в мелодии.</p> <comment>Упомянуть эксперименты, где мелодия использует дидимову комму</comment>

    <subsection>
        <h2>Результаты расчета ладов для минорной полиладовости:</h2>
        <p> [Вставить визуализацию результатов] </p>
    </subsection>

    <subsection>
        <h2>Прототип программы:</h2>
        <p>[Описание функционала программы на Julia]</p>
        <p>[Ссылка на код программы]</p>
    </subsection>
<subsection>
<h2>Звуковые примеры:</h2>
<p>[Вставить аудио примеры]</p>
</subsection>
</section>


  <section>
    <h1>VII. Заключение и перспективы</h1>

    <p>... Выводы и обобщение результатов.  Философское значение: Переосмысление гармонии, расширение границ музыкального выражения. "Глобальная" гармония с локальными "регионами" (лады). Работа с гармонией как с живым пространством с множеством измерений.</p>


    <subsection>
<h2>Мнение GPT-4:</h2>
<p>Тема минорной полиладовости на основе унтертонов открывает ...  На мой взгляд, развивая эту систему, можно прийти к новой философии музыки — такой, где композитор воспринимает гармонию не как жёсткий каркас, а как живое пространство с множеством измерений, в каждом из которых есть свобода, но все они соединены в одном едином гармоническом поле.</p>
    </subsection>
  </section>

<appendix>
<h2>VIII. Приложения</h2>

<subsection>
<h2>Код программы на Julia:</h2>
<pre><code class="language-julia">
  # Код программы
</code></pre>
</subsection>

<subsection>
<h2>Подробные математические выкладки:</h2>
<p>[Вставить выкладки]</p>
</subsection>


<subsection>
<h2>Дополнительные иллюстрации и схемы:</h2>
<p>[Вставить иллюстрации]</p>
</subsection>

</appendix>

</article>